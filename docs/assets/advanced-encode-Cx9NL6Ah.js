import{K as ee,C as L,r as g,M as d,g as M,j as s,B as x,H as O,T as v,N as te,I as V,L as N,b as S,c as se,a as ae,f as W,S as ne,P as R,J as ie,m as E,h as G}from"./index-C1uYeYWW.js";import{b as J,n as D,a as T,c as _,j as oe,k as b,T as P,i as H,l as re,C as $,P as le,F as ce,H as y,I as he,S as z,N as F}from"./number-input-CDXRUuL2.js";import{G as A,W as K,u as B,a as de}from"./warn-dialog-oSx1nXlp.js";const ue=a=>(t,e,n)=>(n.setState=(r,o,...l)=>{const c=typeof r=="function"?ee(r):r;return t(c,o,...l)},a(n.setState,e,n)),U=ue;function fe({inputs:a,output:t}){if(a.length===0)return console.error("No input images provided for encoding."),!1;const e=a[0].imageData.width,n=a[0].imageData.height,r=a[0].imageData.data.length;for(const c of a)if(c.imageData.width!==e||c.imageData.height!==n)return console.error("All input images must have the same dimensions."),!1;if(t.width!==e||t.height!==n)return console.error("Output image must have the same dimensions as input images."),!1;const o=t.data,l=a.reduce((c,u)=>c+u.weight,0);for(let c=0,u=0,i=0;c<r;c+=4){const h=xe(u,i,l,a),I=h.lowerThreshold,f=h.higherThreshold,j=h.imageData.data[c],w=h.imageData.data[c+1],q=h.imageData.data[c+2],Q=h.imageData.data[c+3],X=k(j,I,f),Y=k(w,I,f),Z=k(q,I,f);o[c]=X,o[c+1]=Y,o[c+2]=Z,o[c+3]=Q,u++,u>=e&&(u=0,i++)}return!0}function k(a,t,e){return t>=e?t:Math.floor(Math.max(t,Math.min(a*(e-t)/255+t,e)))}function xe(a,t,e,n){const r=(a+t)%e;for(let o=0,l=0;o<n.length&&l<e;o++){if(l+n[o].weight>r)return n[o];l+=n[o].weight}return n[n.length-1]}class ge extends J{resizedData=D();adjustedData=D();index;constructor(t){super(),this.index=t}bind(t){super.bind(t),this.putImageData(this.adjustedData)}resizeCover(t,e){this.srcData.v&&T.resizeCover(t,e,this.srcData,this.resizedData)}adjust(){if(!this.resizedData.v)return;const t=m.getState().getConfig(this.index),e=D();t.isGray?T.toGray(this.resizedData,e):e.v=this.resizedData.v;const n=D();t.contrast!==0?T.adjustContrast(t.contrast,e,n):n.v=e.v,this.adjustedData.v=n.v}}class me extends J{resultData=D();inputCanvases=new Map;bind(t){super.bind(t),this.putImageData(this.resultData)}resize(t){for(const e of this.inputCanvases.values())e.resizeCover(t.width,t.height),e.adjust(),e.putImageData(e.adjustedData)}createInputCanvas(t){this.inputCanvases.has(t)||this.inputCanvases.set(t,new ge(t))}removeInputCanvas(t){this.inputCanvases.has(t)&&(this.inputCanvases.delete(t),C.getState().setHasInput(t,!1))}bindInputCanvas(t,e){this.inputCanvases.get(t)?.bind(e)}unbindInputCanvas(t){this.inputCanvases.get(t)?.unbind()}adjustInput(t){const e=this.inputCanvases.get(t);if(!e){console.error(`Input canvas for index ${t.toString()} does not exist.`);return}e.adjust(),e.putImageData(e.adjustedData)}setInputImage(t,e){const n=this.inputCanvases.get(e);if(!n)return console.error(`Input canvas for index ${e.toString()} does not exist.`),!1;n.setImage(t,!1);const r=m.getState().size;n.resizeCover(r.width,r.height),n.adjust(),n.putImageData(n.adjustedData);const o=C.getState().getHasInput(e);return C.getState().setHasInput(e,!0),!o}encode(){const t=r=>{console.error(r),this.resultData.v=null,C.setState({hasOutput:!1})},e=[];for(const[r,o]of this.inputCanvases.entries()){const l=m.getState().getConfig(r);o.adjustedData.v&&e.push({imageData:o.adjustedData.v,lowerThreshold:l.lowerThreshold,higherThreshold:l.higherThreshold,weight:l.weight})}if(e.length===0){t("No valid input images to encode.");return}if(T.matchSize({v:e[0].imageData},this.resultData),!this.resultData.v){t("Failed to create output image data.");return}if(!fe({inputs:e,output:this.resultData.v})){t("Failed to encode image.");return}this.putImageData(this.resultData),C.setState({hasOutput:!0})}encodeResultToFile(t){return this.encodeImageFile(this.resultData,t)}async saveResult(t){return this.saveImageFile(await this.encodeResultToFile(t),t)}}const p=new me,m=L()(U((a,t)=>({configs:{},indexes:[],size:{width:d.width,height:d.height},saveFormat:d.saveFormat,dontCareConflict:d.dontCareConflict,getMaxIndex:()=>{const e=t().indexes;return e.length>0?e[e.length-1]:-1},createConfig:()=>{const e=t().getMaxIndex();let n=d.thresholdStart;e>=0&&(n=t().configs[e].higherThreshold+d.thresholdGap);let r=n+d.thresholdWidth;r>255&&(r=255),n>=r&&(n=d.thresholdStart,r=n+d.thresholdWidth);const o=t().getMaxIndex()+1;p.createInputCanvas(o),a(l=>{l.indexes.push(o),l.configs[o]={lowerThreshold:n,higherThreshold:r,contrast:d.contrast,isGray:d.isGray,weight:d.weight}})},getConfig:e=>t().configs[e]||{lowerThreshold:d.thresholdStart,higherThreshold:d.thresholdStart+d.thresholdWidth,contrast:d.contrast,isGray:d.isGray,weight:d.weight},setConfigValue:(e,n,r)=>{a(o=>{if(o.configs[e])switch(n){case"lowerThreshold":case"higherThreshold":case"contrast":case"weight":o.configs[e][n]=Number(r);break;case"isGray":o.configs[e][n]=!!r;break}})},removeConfig:e=>{p.removeInputCanvas(e),a(n=>{delete n.configs[e],n.indexes=n.indexes.filter(r=>r!==e)})},setSize:(e,n)=>{a({size:{width:e,height:n}})},setDontCareConflict:e=>{a({dontCareConflict:e})},testConflict:()=>{const e=[];if(t().dontCareConflict)return!1;const n=t().configs;for(const o of C.getState().hasInput){const l=n[o];if(l){const{lowerThreshold:c,higherThreshold:u}=l;if(c>u)return!0;e.push({l:c,r:u})}}e.sort((o,l)=>o.l-l.l);let r=-1;for(const o of e){if(o.l<=r)return!0;r=o.r}return!1},setSaveFormat:e=>{a({saveFormat:e})}}))),C=L()(U((a,t)=>({hasOutput:!1,hasInput:new Set,setHasOutput:e=>{a({hasOutput:e})},setHasInput:(e,n)=>{a(r=>{n?r.hasInput.add(e):r.hasInput.delete(e)})},getHasInput:e=>t().hasInput.has(e)})));function pe(){const a=m(e=>e.indexes),t=m(e=>e.createConfig);g.useEffect(()=>{a.length===0&&t()},[a,t])}function Fe(){const a=M();return pe(),s.jsxs(x,{sx:{display:"flex",flexDirection:"column",width:"100%",maxWidth:a?"lg":"sm",mx:"auto",gap:1},children:[s.jsx(Ce,{}),s.jsx(ve,{}),s.jsxs(x,{sx:{display:"flex",flexDirection:"column",width:"100%",maxWidth:"sm",mx:"auto",gap:1},children:[s.jsx(Se,{}),s.jsx(De,{}),s.jsx(ye,{})]})]})}function Ce(){const a=O(t=>t.setCurrentRoute);return s.jsxs(x,{sx:{display:"flex",flexDirection:"column",p:1,gap:1},children:[s.jsxs(v,{variant:"h6",color:"primary",children:[s.jsx("b",{children:"Â§çÂêà"}),"ÂÖâÊ£±Âù¶ÂÖã"]}),s.jsxs(v,{variant:"body1",children:["ËøôÊòØÂÖÅËÆ∏ËæìÂÖ•",s.jsx("b",{children:"Ë∂ÖËøá‰∏§Âº†ÂõæÁâá"}),'ÁöÑÊ®°Âºè ü§ì Êé®ËçêÂú®ÂØπ"ÂÖâÊ£±Âù¶ÂÖã"ÁöÑÂéüÁêÜÊúâÂü∫Á°ÄÁöÑ‰∫ÜËß£ÂêéÂÜç‰ΩøÁî®„ÄÇÊàñËÄÖÂ¶ÇÊûúÊÇ®ÊÅ∞Â∑ßÁêÜËß£ËÉΩÂäõË∂ÖÁæ§ üßê ‰πüÂèØ‰ª•ËæπËØïËæπÂ≠¶‚Äî‚ÄîÊâÄÊúâÁöÑÂõæÁâáÂùáÂú®ÊÇ®ÁöÑÊµèËßàÂô®Êú¨Âú∞ÁîüÊàêÔºåÊ≤°Êúâ‰∫∫‰ºöÊúâ‰ªª‰ΩïÊÑèËßÅ üòâ']}),s.jsxs(v,{variant:"body1",children:["ËØ∑Ê≥®ÊÑèÔºåÁî±‰∫éÊ∏≤ÊüìÁöÑÂ§çÊùÇÊÄßÔºåÊ≠§È°µÈù¢ÊöÇÊó∂",s.jsx("b",{children:"‰∏çÊèê‰æõ"}),"ÁªìÊûúÁöÑÂÆûÊó∂È¢ÑËßà üò• Êõ¥Êñ∞ÂèÇÊï∞ÂêéËØ∑ËÆ∞ÂæóÊâãÂä®ÁÇπÂáªÊåâÈíÆÈáçÊñ∞ÁîüÊàê üôÇ"]}),s.jsxs(v,{variant:"body1",children:["Âè¶Â§ñÔºåÁõ∏ËæÉ1.xÁâàÊú¨Ôºå",s.jsx(te,{component:"button",variant:"body1",onClick:()=>{a(V.decode)},children:"ÊòæÂΩ¢ÁïåÈù¢"})," ","ÁöÑÈòàÂÄºÊªëÊù°Â§ö‰∫Ü‰∏Ä‰∏™Á´ØÁÇπÔºåËøôÊ≠£ÊòØ‰∏∫ÊòæÂΩ¢Â§çÂêàÂù¶ÂÖãÂáÜÂ§áÁöÑ üòé"]})]})}function ve(){const a=M(),t=m(e=>e.indexes);return s.jsx(A,{container:!0,spacing:1,maxWidth:a?"lg":"sm",children:t.map(e=>s.jsx(A,{size:a?6:12,children:s.jsx(je,{index:e})},e))})}function je({index:a}){const t=R[a%R.length],e=C(n=>n.getHasInput(a));return s.jsx(ne,{primaryPaletteKey:t,children:s.jsx(_,{children:s.jsxs(x,{sx:{display:"flex",flexDirection:"row",width:"100%",gap:2,alignItems:"center"},children:[s.jsx(we,{index:a,hasImage:e}),s.jsx(Ie,{index:a,disabled:!1})]})})})}function we({index:a,hasImage:t}){const n=ie()?120:200,r=m(i=>i.createConfig),o=m(i=>i.removeConfig),l=g.useCallback(i=>{p.setInputImage(i,a)&&r()},[a,r]),c=()=>{t&&o(a)},u=g.useRef(null);return g.useEffect(()=>(p.bindInputCanvas(a,u.current),()=>{p.unbindInputCanvas(a)}),[a]),s.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:1,px:1,width:n},children:[s.jsx(he,{onconfirm:l,label:"Âä†ËΩΩ"}),!t&&s.jsx($,{text:"(ÔΩ•_ÔΩ•`)>",aspectRatio:"1",styles:{width:"100%",objectFit:"contain"}}),s.jsx("canvas",{ref:u,style:{maxWidth:n,maxHeight:n,display:t?"block":"none",objectFit:"contain"}}),s.jsx(S,{variant:"outlined",size:"small",sx:{width:"100%",border:"2px solid"},onClick:c,disabled:!t,children:"ÁßªÈô§"})]})}function Ie({index:a,disabled:t}){const e=m(i=>i.getConfig(a)),n=m(i=>i.setConfigValue),r=i=>{n(a,"lowerThreshold",i)},o=i=>{n(a,"higherThreshold",i)},l=i=>{n(a,"contrast",i)},c=i=>{n(a,"isGray",i)},u=i=>{n(a,"weight",i)};return g.useEffect(()=>{p.adjustInput(a)},[a,e.contrast,e.lowerThreshold,e.higherThreshold,e.isGray]),s.jsxs(x,{sx:{flex:1,display:"flex",flexDirection:"column"},children:[s.jsxs(x,{sx:{display:"flex",flexDirection:"row",alignItems:"center"},children:[s.jsx(v,{variant:"body2",children:"1. Ëâ≤Èò∂Á´ØÁÇπ:"}),s.jsx(x,{sx:{flex:1}}),s.jsx(y,{message:"Âª∫ËÆÆÈÅøÂÖçÂíåÂÖ∂‰ªñËæìÂÖ•ÂõæÁâáÁöÑËâ≤Èò∂ÈáçÂè†"})]}),s.jsx(z,{value:[e.lowerThreshold,e.higherThreshold],min:0,max:255,step:d.thresholdStep,onChange:(i,h)=>{r(h[0]),o(h[1])},disabled:t}),s.jsxs(x,{sx:{display:"flex",flexDirection:"row",gap:1},children:[s.jsx(F,{realValue:e.lowerThreshold,onSubmit:i=>{r(i)},min:0,max:e.higherThreshold,step:d.thresholdStep,sx:{width:"80px"},disabled:t,variant:"standard"}),s.jsx(F,{realValue:e.higherThreshold,onSubmit:i=>{o(i)},min:e.lowerThreshold,max:255,step:d.thresholdStep,sx:{width:"80px"},disabled:t,variant:"standard"})]}),s.jsxs(x,{sx:{mt:1,display:"flex",flexDirection:"row",alignItems:"center"},children:[s.jsx(v,{variant:"body2",children:"2. ÂØπÊØîÂ∫¶:"}),s.jsx(x,{sx:{flex:1}}),s.jsx(y,{message:"‰∏çÂêàÁêÜÁöÑÂØπÊØîÂ∫¶‰ºö‰∏•ÈáçÈôç‰ΩéÊòæÂΩ¢Ë¥®Èáè"})]}),s.jsx(z,{value:e.contrast,min:G,max:E,step:d.contrastStep,onChange:(i,h)=>{l(h)},disabled:t}),s.jsxs(x,{sx:{display:"flex",flexDirection:"row",gap:1},children:[s.jsx(F,{realValue:e.contrast,onSubmit:i=>{l(i)},min:G,max:E,step:d.contrastStep,sx:{width:"80px"},disabled:t,variant:"standard"}),s.jsx(S,{size:"small",sx:{width:"80px"},onClick:()=>{l(0)},disabled:t,children:"ÈáçÁΩÆÂØπÊØîÂ∫¶"})]}),s.jsxs(x,{sx:{mt:1,display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[s.jsx(v,{variant:"body2",children:"3. ÂèñÁÅ∞Â∫¶:"}),s.jsx(de,{size:"medium",checked:e.isGray,onChange:i=>{c(i.target.checked)},disabled:t}),s.jsx(x,{sx:{flex:1}}),s.jsx(y,{message:"ËàçÂºÉÈ¢úËâ≤ÂèØÊòæËëóÊèêÂçáÊäóÂéãÁº©ËÉΩÂäõ"})]}),s.jsxs(x,{sx:{mt:1,display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[s.jsx(v,{variant:"body2",children:"4. Ê∑∑ÂêàÊùÉÈáç:"}),s.jsx(z,{value:e.weight,min:1,max:4,step:1,onChange:(i,h)=>{u(h)},sx:{flex:1,ml:1,minWidth:"60px"},valueLabelDisplay:"auto",marks:!0,disabled:t}),s.jsx(x,{sx:{flex:1}}),s.jsx(y,{message:"ÊùÉÈáçË∂äÈ´òÔºåË∂äÂÆπÊòìÁõ¥Êé•ÁúãÂá∫"})]})]})}function Se(){const a=m(i=>i.size),t=m(i=>i.setSize),[e,n]=g.useState(!1),[r,o]=g.useState(a.width),[l,c]=g.useState(a.height),u=g.useCallback((i,h)=>{n(!0);try{t(i,h),p.resize({width:i,height:h})}finally{n(!1)}},[t]);return s.jsxs(s.Fragment,{children:[e&&s.jsx(N,{}),s.jsx(_,{children:s.jsxs(oe,{sx:{display:"flex",flexDirection:"row",gap:1,width:"100%",alignItems:"center",justifyContent:"center"},children:[s.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:1},children:[s.jsxs(x,{sx:{display:"flex",flexDirection:"row",alignItems:"end",gap:1},children:[s.jsx(b,{children:"ÂΩìÂâçÂÆΩÂ∫¶:"}),s.jsx(P,{value:a.width,size:"small",variant:"standard",sx:{maxWidth:"60px"},disabled:!0}),s.jsx(b,{children:"Êñ∞ÂÆΩÂ∫¶:"}),s.jsx(H,{initValue:r,onChange:o,size:"small",variant:"standard",sx:{maxWidth:"60px"},min:d.minSize,max:d.maxSize})]}),s.jsxs(x,{sx:{display:"flex",flexDirection:"row",alignItems:"end",gap:1},children:[" ",s.jsx(b,{children:"ÂΩìÂâçÈ´òÂ∫¶:"}),s.jsx(P,{value:a.height,size:"small",variant:"standard",sx:{maxWidth:"60px"},disabled:!0}),s.jsx(b,{children:"Êñ∞È´òÂ∫¶:"}),s.jsx(H,{initValue:l,onChange:c,size:"small",variant:"standard",sx:{maxWidth:"60px"},min:d.minSize,max:d.maxSize})]})]}),s.jsx(S,{sx:{aspectRatio:1,minWidth:0,padding:0,p:1},component:"label",onClick:()=>{u(r,l)},children:s.jsx(re,{})})]})})]})}function De(){const[a,t]=g.useState(!1),e=C(h=>h.hasOutput),n=m(h=>h.testConflict),r=m(h=>h.dontCareConflict),o=m(h=>h.setDontCareConflict),[l,c]=g.useState(!1),u=g.useCallback(h=>{t(!0);try{if(!h&&n()){c(!0);return}p.encode()}finally{t(!1)}},[n]),i=g.useRef(null);return g.useEffect(()=>(p.bind(i.current),()=>{p.unbind()}),[]),s.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:1},children:[a&&s.jsx(N,{}),s.jsx(K,{show:l,onClose:()=>{c(!1)},onConfirm:()=>{c(!1),u(!0)},showWarning:!r,setShowWarning:h=>{o(!h)},title:"Ëâ≤Èò∂Âå∫Èó¥Â≠òÂú®ÂÜ≤Á™ÅÔºÅ",content:["Âª∫ËÆÆÈÅøÂÖçËæìÂÖ•ÂõæÁâáÁöÑËâ≤Èò∂Á´ØÁÇπ‰πãÈó¥ÂèëÁîüÈáçÂè†ÔºåÂê¶ÂàôÊòæÂΩ¢ÊïàÊûúÂèØËÉΩ‰∏çÂ¶ÇÈ¢ÑÊúü„ÄÇ","‰æãÂ¶Ç 0-24 ‰∏é 12-36 Â≠òÂú®ÈáçÂè†, Âª∫ËÆÆË∞ÉÊï¥‰∏∫ 0-24 ‰∏é 25-49„ÄÇ"]}),s.jsx(S,{variant:"contained",onClick:()=>{u(!1)},fullWidth:!0,children:"ÂÖâÊ£±ÔºåÂêØÂä®ÔºÅ"}),!e&&s.jsx($,{text:"Âè™ÊòØ‰∏ÄÂº†ÁîªÂ∏É",styles:{width:"100%",objectFit:"contain"}}),s.jsx("canvas",{ref:i,style:{maxWidth:"100%",maxHeight:"100%",display:e?"block":"none"}})]})}function ye(){const a=m(f=>f.saveFormat),t=m(f=>f.setSaveFormat),e=B(f=>f.showWarning),n=B(f=>f.setShowWarning),[r,o]=g.useState(!1),l=se(f=>f.setImages),c=O(f=>f.setCurrentRoute),[u,i]=g.useState(!1),h=g.useCallback((f,j)=>{if(!j&&f!=="JPEG"&&e){o(!0);return}i(!0),p.saveResult(f).then(w=>{ae(`Â∑≤‰øùÂ≠ò‰∏∫ ${w}`)}).catch(w=>{console.error("Failed to save result:",w),W("‰øùÂ≠òÂ§±Ë¥•")}).finally(()=>{i(!1)})},[e]),I=g.useCallback(f=>{i(!0),(async()=>{const j=await p.encodeResultToFile(f),w=await le.fromFileData(j);l([w]),c(V.decode)})().catch(j=>{console.error("Failed to encode result:",j),W("Ë∑≥ËΩ¨Â§±Ë¥•")}).finally(()=>{i(!1)})},[l,c]);return s.jsxs(x,{sx:{width:"100%",display:"flex",flexDirection:"row",gap:1},children:[s.jsx(K,{show:r,onClose:()=>{o(!1)},onConfirm:()=>{o(!1),h(a,!0)},showWarning:e,setShowWarning:n,title:`Á°ÆËÆ§‰øùÂ≠ò‰∏∫ ${a}?`,content:["Èùû JPEG Ê†ºÂºèÂèØËÉΩ‰ºöË¢´Êüê‰∫õÁ§æ‰∫§Âπ≥Âè∞Âº∫Âà∂ÂéãÁº©ÔºåËøôÂ∞Ü‰∏•ÈáçÂΩ±ÂìçÊòæÂΩ¢ÊïàÊûú„ÄÇËØ∑Ë∞®ÊÖéÈÄâÊã©„ÄÇ"]}),s.jsx(S,{sx:{flex:1},variant:"contained",onClick:()=>{h(a,!1)},disabled:u,children:"‰øùÂ≠òÁªìÊûú"}),s.jsx(S,{sx:{flex:1},variant:"contained",color:"secondary",onClick:()=>{I(a)},disabled:u,children:"ÊòæÂΩ¢ÊµãËØï"}),s.jsx(ce,{format:a,onChange:f=>{t(f)},disabled:u}),s.jsx(y,{message:"Èùû JPEG Ê†ºÂºèÊúâËæÉÈ´òÁöÑË¢´Á§æ‰∫§Âπ≥Âè∞Âº∫Âà∂ÂéãÁº©ÁöÑÈ£éÈô©"})]})}export{Fe as default};
