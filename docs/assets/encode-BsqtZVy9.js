import{i as _,k as q,r as h,l as le,j as n,n as T,o as J,p as A,q as ce,t as de,v as ue,w as we,x as E,y as X,z as De,A as ze,C as he,F as xe,E as v,h as B,m as W,g as fe,B as f,b as F,G as ke,T as k,c as Fe,H as Ge,a as Me,f as Y,I as Pe,J as Te,e as ee}from"./index-CGfsbu-D.js";import{u as pe,f as Ee,e as Be,g as We,a as M,b as me,n as P,C as ge,c as ve,h as $e,i as Ne,H as D,P as Ue,F as Oe,I as Ve,S as $,N as se,j as Le,k as L}from"./number-input-BFXS09dJ.js";import{S as He,G as H,a as Ce,u as te,W as _e,F as ne}from"./warn-dialog-Db6qWQ4C.js";function qe(s){return _("MuiFormGroup",s)}q("MuiFormGroup",["root","row","error"]);const Je=s=>{const{classes:e,row:t,error:a}=s;return A({root:["root",t&&"row",a&&"error"]},qe,e)},Ae=T("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(s,e)=>{const{ownerState:t}=s;return[e.root,t.row&&e.row]}})({display:"flex",flexDirection:"column",flexWrap:"wrap",variants:[{props:{row:!0},style:{flexDirection:"row"}}]}),Ze=h.forwardRef(function(e,t){const a=le({props:e,name:"MuiFormGroup"}),{className:r,row:d=!1,...l}=a,p=pe(),o=Ee({props:a,muiFormControl:p,states:["error"]}),m={...a,row:d,error:o.error},I=Je(m);return n.jsx(Ae,{className:J(I.root,r),ownerState:m,ref:t,...l})}),Ke=ce(n.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"})),Qe=ce(n.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"})),Xe=T("span",{name:"MuiRadioButtonIcon",shouldForwardProp:de})({position:"relative",display:"flex"}),Ye=T(Ke,{name:"MuiRadioButtonIcon"})({transform:"scale(1)"}),es=T(Qe,{name:"MuiRadioButtonIcon"})(ue(({theme:s})=>({left:0,position:"absolute",transform:"scale(0)",transition:s.transitions.create("transform",{easing:s.transitions.easing.easeIn,duration:s.transitions.duration.shortest}),variants:[{props:{checked:!0},style:{transform:"scale(1)",transition:s.transitions.create("transform",{easing:s.transitions.easing.easeOut,duration:s.transitions.duration.shortest})}}]})));function be(s){const{checked:e=!1,classes:t={},fontSize:a}=s,r={...s,checked:e};return n.jsxs(Xe,{className:t.root,ownerState:r,children:[n.jsx(Ye,{fontSize:a,className:t.background,ownerState:r}),n.jsx(es,{fontSize:a,className:t.dot,ownerState:r})]})}const je=h.createContext(void 0);function ss(){return h.useContext(je)}function ts(s){return _("MuiRadio",s)}const ae=q("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),ns=s=>{const{classes:e,color:t,size:a}=s,r={root:["root",`color${E(t)}`,a!=="medium"&&`size${E(a)}`]};return{...e,...A(r,ts,e)}},as=T(He,{shouldForwardProp:s=>de(s)||s==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(s,e)=>{const{ownerState:t}=s;return[e.root,t.size!=="medium"&&e[`size${E(t.size)}`],e[`color${E(t.color)}`]]}})(ue(({theme:s})=>({color:(s.vars||s).palette.text.secondary,[`&.${ae.disabled}`]:{color:(s.vars||s).palette.action.disabled},variants:[{props:{color:"default",disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:s.alpha((s.vars||s).palette.action.active,(s.vars||s).palette.action.hoverOpacity)}}},...Object.entries(s.palette).filter(X()).map(([e])=>({props:{color:e,disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:s.alpha((s.vars||s).palette[e].main,(s.vars||s).palette.action.hoverOpacity)}}})),...Object.entries(s.palette).filter(X()).map(([e])=>({props:{color:e,disabled:!1},style:{[`&.${ae.checked}`]:{color:(s.vars||s).palette[e].main}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]})));function os(s,e){return typeof e=="object"&&e!==null?s===e:String(s)===String(e)}const rs=n.jsx(be,{checked:!0}),is=n.jsx(be,{}),oe=h.forwardRef(function(e,t){const a=le({props:e,name:"MuiRadio"}),{checked:r,checkedIcon:d=rs,color:l="primary",icon:p=is,name:o,onChange:m,size:I="medium",className:j,disabled:c,disableRipple:y=!1,slots:b={},slotProps:i={},inputProps:g,...C}=a,x=pe();let S=c;x&&typeof S>"u"&&(S=x.disabled),S??=!1;const w={...a,disabled:S,disableRipple:y,color:l,size:I},z=ns(w),G=ss();let U=r;const ye=Be(m,G&&G.onChange);let O=o;G&&(typeof U>"u"&&(U=os(G.value,a.value)),typeof O>"u"&&(O=G.name));const V=i.input??g,[Re,Se]=we("root",{ref:t,elementType:as,className:J(z.root,j),shouldForwardComponentProp:!0,externalForwardedProps:{slots:b,slotProps:i,...C},getSlotProps:Z=>({...Z,onChange:(K,...Q)=>{Z.onChange?.(K,...Q),ye(K,...Q)}}),ownerState:w,additionalProps:{type:"radio",icon:h.cloneElement(p,{fontSize:p.props.fontSize??I}),checkedIcon:h.cloneElement(d,{fontSize:d.props.fontSize??I}),disabled:S,name:O,checked:U,slots:b,slotProps:{input:typeof V=="function"?V(w):V}}});return n.jsx(Re,{...Se,classes:z})});function ls(s){return _("MuiRadioGroup",s)}q("MuiRadioGroup",["root","row","error"]);const cs=s=>{const{classes:e,row:t,error:a}=s;return A({root:["root",t&&"row",a&&"error"]},ls,e)},ds=h.forwardRef(function(e,t){const{actions:a,children:r,className:d,defaultValue:l,name:p,onChange:o,value:m,...I}=e,j=h.useRef(null),c=cs(e),[y,b]=We({controlled:m,default:l,name:"RadioGroup"});h.useImperativeHandle(a,()=>({focus:()=>{let x=j.current.querySelector("input:not(:disabled):checked");x||(x=j.current.querySelector("input:not(:disabled)")),x&&x.focus()}}),[]);const i=De(t,j),g=ze(p),C=h.useMemo(()=>({name:g,onChange(x){b(x.target.value),o&&o(x,x.target.value)},value:y}),[g,o,b,y]);return n.jsx(je.Provider,{value:C,children:n.jsx(Ze,{role:"radiogroup",ref:i,className:J(c.root,d),...I,children:r})})});function Ie(s,e,t,a,r){return t===0?(r?e:s)%(a+1)<a:r?(e/t+s)%(a+1)<a:(s/t+e)%(a+1)<a}function us(s,e,t,{innerThreshold:a,coverThreshold:r,slope:d,gap:l,isRow:p,isReverse:o}){const m=(i,g)=>Ie(i,g,d,l,p),I=(i,g,C)=>Math.floor(C(i,g)),j=(i,g)=>I(i,g,o?(C,x)=>255-x+C*x/255:(C,x)=>C*x/255),c=(i,g)=>I(i,g,o?(C,x)=>C*(255-x)/255:(C,x)=>x+C*(255-x)/255),y=s.width,b=s.data.length;for(let i=0,g=0,C=0;i<b;i+=4){if(m(g,C)){const x=e.data[i],S=e.data[i+1],w=e.data[i+2],z=e.data[i+3];t.data[i]=c(x,r),t.data[i+1]=c(S,r),t.data[i+2]=c(w,r),t.data[i+3]=z}else{const x=s.data[i],S=s.data[i+1],w=s.data[i+2],z=s.data[i+3];t.data[i]=j(x,a),t.data[i+1]=j(S,a),t.data[i+2]=j(w,a),t.data[i+3]=z}g+=1,g>=y&&(g=0,C+=1)}}function hs(s,e,t){return e=M.scaleContrastCompress(e),`${t?"1":"0"}${s.toString(16).padStart(2,"0")}${e.toString(16).padStart(2,"0")}`}class re extends me{resizedData=P();adjustedData=P();isInner;constructor(e){super(),this.isInner=e}bind(e){super.bind(e)}resizeFit(){if(!this.srcData.v)return;const{maxSize:e}=u.getState();M.resizeFit(e,this.srcData,this.resizedData)}resizeCover(e,t){this.srcData.v&&M.resizeCover(e,t,this.srcData,this.resizedData)}getSize(){return{width:this.resizedData.v?.width??0,height:this.resizedData.v?.height??0}}adjust(){if(!this.resizedData.v)return;let e,t;this.isInner?(e=u.getState().isInnerGray,t=u.getState().innerContrast):(e=u.getState().isCoverGray,t=u.getState().coverContrast);const a=P();e?M.toGray(this.resizedData,a):a.v=this.resizedData.v;const r=P();t!==0?M.adjustContrast(t,a,r):r.v=a.v,this.adjustedData.v=r.v}}class xs extends me{inner=new re(!0);cover=new re(!1);resultData=P();bind(e){super.bind(e),this.subscribe(u.subscribe(t=>t.maxSize,()=>{this.resize(),this.encodeResult()})),this.subscribe(u.subscribe(t=>t.innerContrast,()=>{this.inner.adjust(),this.inner.putImageData(this.inner.adjustedData),this.encodeResult()})),this.subscribe(u.subscribe(t=>t.coverContrast,()=>{this.cover.adjust(),this.cover.putImageData(this.cover.adjustedData),this.encodeResult()})),this.subscribe(u.subscribe(t=>t.isInnerGray,()=>{this.inner.adjust(),this.inner.putImageData(this.inner.adjustedData),this.encodeResult()})),this.subscribe(u.subscribe(t=>t.isCoverGray,()=>{this.cover.adjust(),this.cover.putImageData(this.cover.adjustedData),this.encodeResult()})),this.subscribe(u.subscribe(t=>t.blendMode,()=>{this.encodeResult()})),this.subscribe(u.subscribe(t=>t.innerThreshold,()=>{this.encodeResult()})),this.subscribe(u.subscribe(t=>t.coverThreshold,()=>{this.encodeResult()})),this.subscribe(u.subscribe(t=>t.isReverse,()=>{this.encodeResult()})),this.resize(),this.encodeResult()}unbind(){super.unbind()}setInnerImage(e){this.inner.setImage(e,!1),this.resize(),this.cover.hasImage()&&this.encodeResult()}setCoverImage(e){if(this.cover.setImage(e,!1),!this.inner.hasImage()){this.cover.putImageData(this.cover.srcData);return}this.resize(),this.encodeResult()}resize(){if(!this.inner.hasImage()||(this.inner.resizeFit(),this.inner.adjust(),this.inner.putImageData(this.inner.adjustedData),!this.cover.hasImage()))return;const{width:e,height:t}=this.inner.getSize();this.cover.resizeCover(e,t),this.cover.adjust(),this.cover.putImageData(this.cover.adjustedData)}bindInner=e=>{this.inner.bind(e)};bindCover=e=>{this.cover.bind(e)};unbindInner=()=>{this.inner.unbind()};unbindCover=()=>{this.cover.unbind()};encodeResult(){const e=this.inner.adjustedData.v,t=this.cover.adjustedData.v;if(!e||!t||e.width!==t.width||e.height!==t.height)return;(!this.resultData.v||this.resultData.v.width!==e.width||this.resultData.v.height!==e.height)&&(this.resultData.v=new ImageData(e.width,e.height));const a=this.resultData.v,{innerThreshold:r,coverThreshold:d,blendMode:{slope:l,gap:p,isRow:o},isReverse:m}=u.getState();us(e,t,a,{innerThreshold:r,coverThreshold:d,slope:l,gap:p,isRow:o,isReverse:m}),this.resultData.v=a,N.getState().haveResult=!0,this.putImageData(this.resultData)}async saveResult(e){const t=await this.encodeImageFile(this.resultData,e);return this.saveImageFile(t,e)}encodeResultToFile(e){const{innerThreshold:t,innerContrast:a,isReverse:r}=u.getState(),d=hs(t,a,r);return this.encodeImageFile(this.resultData,e,d)}}const R=new xs,u=he()(xe(s=>({innerThreshold:v.innerThreshold,coverThreshold:v.coverThreshold,innerContrast:v.innerContrast,coverContrast:v.coverContrast,isInnerGray:v.isInnerGray,isCoverGray:v.isCoverGray,isReverse:v.isReverse,saveFormat:v.saveFormat,maxSize:v.maxSize,blendMode:{slope:v.blendMode.slope,gap:v.blendMode.gap,isRow:v.blendMode.isRow},setInnerThreshold:e=>{s(t=>e>=t.coverThreshold||e<0?{}:{innerThreshold:e})},setCoverThreshold:e=>{s(t=>e<=t.innerThreshold||e>255?{}:{coverThreshold:e})},setInnerContrast:e=>{e<B||e>W||s({innerContrast:e})},setCoverContrast:e=>{e<B||e>W||s({coverContrast:e})},setIsInnerGray:e=>{s({isInnerGray:e})},setIsCoverGray:e=>{s({isCoverGray:e})},setIsReverse:e=>{s({isReverse:e})},setSaveFormat:e=>{s({saveFormat:e})},setMaxSize:e=>{e<v.minMaxSize||e>v.maxMaxSize||s({maxSize:e})},setBlendMode:(e,t,a)=>{s({blendMode:{slope:e,gap:t,isRow:a}})}}))),N=he()(xe(s=>({innerImage:null,coverImage:null,haveResult:!1,setInnerImage:e=>{e&&R.setInnerImage(e),s({innerImage:e})},setCoverImage:e=>{e&&R.setCoverImage(e),s({coverImage:e})},setHaveResult:e=>{s({haveResult:e})}})));function Ds(){const s=fe();return n.jsxs(f,{sx:{display:"flex",flexDirection:"column",width:"100%",maxWidth:s?"lg":"sm",mx:"auto"},children:[n.jsx(fs,{}),n.jsxs(f,{sx:{display:"flex",flexDirection:s?"row":"column",mt:2,gap:2},children:[n.jsx(vs,{}),n.jsx(gs,{})]})]})}function fs(){const s=fe();return n.jsxs(H,{container:!0,spacing:2,children:[n.jsx(H,{size:s?6:12,children:n.jsx(ie,{isCover:!1})}),n.jsx(H,{size:s?6:12,children:n.jsx(ie,{isCover:!0})})]})}function ie({isCover:s}){return n.jsx(ve,{children:n.jsxs(f,{sx:{display:"flex",flexDirection:"row",width:"100%",gap:2,alignItems:"center"},children:[n.jsx(ps,{isCover:s}),n.jsx(ms,{isCover:s})]})})}function ps({isCover:s}){const e=N(s?l=>l.coverImage:l=>l.innerImage),t=N(s?l=>l.setCoverImage:l=>l.setInnerImage),a=h.useRef(null),d=Te()?120:200;return h.useEffect(()=>{const l=a.current;if(l)return s?R.bindCover(l):R.bindInner(l),()=>{s?R.unbindCover():R.unbindInner()}}),n.jsxs(f,{sx:{display:"flex",flexDirection:"column",gap:1,px:1,width:d},children:[n.jsx(Ve,{onconfirm:l=>{t(l)},defaultImage:s?ee.encodeCover:ee.encodeInner,label:"加载"}),!e&&n.jsx(ge,{text:"(･_･`)>",aspectRatio:"1",styles:{width:"100%",objectFit:"contain"}}),n.jsx("canvas",{ref:a,style:{maxWidth:d,maxHeight:d,display:e?"block":"none",objectFit:"contain"}})]})}function ms({isCover:s}){const e=u(s?o=>o.coverThreshold:o=>o.innerThreshold),t=u(s?o=>o.innerThreshold:o=>o.coverThreshold),a=u(s?o=>o.coverContrast:o=>o.innerContrast),r=u(s?o=>o.isCoverGray:o=>o.isInnerGray),d=u(s?o=>o.setCoverThreshold:o=>o.setInnerThreshold),l=u(s?o=>o.setCoverContrast:o=>o.setInnerContrast),p=u(s?o=>o.setIsCoverGray:o=>o.setIsInnerGray);return n.jsxs(f,{sx:{flex:1,display:"flex",flexDirection:"column"},children:[n.jsx(k,{variant:"subtitle1",color:"primary",children:s?"表图设置":"里图设置"}),n.jsxs(f,{sx:{mt:1,display:"flex",flexDirection:"row",alignItems:"center"},children:[n.jsx(k,{variant:"body2",children:"1. 色阶端点:"}),n.jsx(f,{sx:{flex:1}}),n.jsx(D,{message:s?"越高显形效果越好":"越低隐藏效果越好"})]}),n.jsx($,{value:e,min:0,max:255,step:v.thresholdStep,track:s?"inverted":"normal",onChange:(o,m)=>{d(m)},valueLabelDisplay:"auto"}),n.jsx(f,{sx:{display:"flex",flexDirection:"row",gap:1},children:n.jsx(se,{realValue:e,onSubmit:o=>{d(o)},min:s?t+1:0,max:s?255:t-1,step:v.thresholdStep,sx:{width:"80px"},variant:"standard"})}),n.jsxs(f,{sx:{mt:1,display:"flex",flexDirection:"row",alignItems:"center"},children:[n.jsx(k,{variant:"body2",children:"2. 对比度:"}),n.jsx(f,{sx:{flex:1}}),n.jsx(D,{message:"不合理的对比度会严重降低显形质量"})]}),n.jsx($,{value:a,min:B,max:W,step:v.contrastStep,onChange:(o,m)=>{l(m)},valueLabelDisplay:"auto"}),n.jsxs(f,{sx:{display:"flex",flexDirection:"row",gap:1},children:[n.jsx(se,{realValue:a,onSubmit:o=>{l(o)},min:B,max:W,step:v.contrastStep,sx:{width:"80px"},variant:"standard"}),n.jsx(F,{size:"small",sx:{width:"80px"},onClick:()=>{l(s?v.coverContrast:v.innerContrast)},children:"重置对比度"})]}),n.jsxs(f,{sx:{mt:1,display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[n.jsx(k,{variant:"body2",children:"3. 取灰度:"}),n.jsx(Ce,{size:"medium",checked:r,onChange:o=>{p(o.target.checked)}}),n.jsx(f,{sx:{flex:1}}),n.jsx(D,{message:"舍弃颜色可显著提升抗压缩能力"})]}),n.jsx(f,{sx:{mt:1,display:"flex",flexDirection:"row",alignItems:"center",gap:1}})]})}function gs(){return n.jsxs(f,{sx:{display:"flex",flexDirection:"column",width:"100%",gap:2},children:[n.jsx(ve,{children:n.jsxs(f,{sx:{display:"flex",flexDirection:"column",gap:2,width:"100%"},children:[n.jsx(Cs,{}),n.jsx(js,{}),n.jsx(Is,{})]})}),n.jsx(ys,{})]})}function vs(){const s=h.useRef(null),e=N(t=>t.haveResult);return h.useEffect(()=>{const t=s.current;if(t)return R.bind(t),()=>{R.unbind()}},[]),n.jsxs(n.Fragment,{children:[!e&&n.jsx(ge,{text:"只是一张画布",styles:{width:"100%"}}),n.jsx("canvas",{ref:s,style:{width:"100%",display:e?"block":"none"}})]})}function Cs(){const[s,e]=h.useState(!1),t=u(d=>d.setBlendMode),a=h.useCallback((d,l,p)=>{t(d,l,p),e(!1),R.encodeResult()},[t]),r=h.useCallback(()=>{e(!1)},[]);return n.jsxs(n.Fragment,{children:[n.jsx(F,{variant:"contained",onClick:()=>{e(!0)},children:"设置混合模式"}),n.jsx($e,{open:s,maxWidth:"sm",fullWidth:!0,sx:{zIndex:ke.dialog},children:n.jsx(bs,{onConfirm:a,onCancel:r})})]})}function bs({onConfirm:s,onCancel:e}){const t=u(j=>j.blendMode),[a,r]=h.useState(t.slope),[d,l]=h.useState(t.gap),[p,o]=h.useState(t.isRow),m=h.useRef(null),I=h.useCallback((j,c,y)=>{const b=m.current;if(!b)return;b.width=8,b.height=8;const i=b.getContext("2d");if(i){i.imageSmoothingEnabled=!1;for(let g=0;g<b.width;g++)for(let C=0;C<b.height;C++)Ie(g,C,j,c,y)?i.fillStyle="white":i.fillStyle="black",i.fillRect(g,C,1,1)}},[]);return h.useEffect(()=>{I(a,d,p)},[a,d,p,I]),n.jsxs(f,{sx:{display:"flex",flexDirection:"column",padding:2,backgroundColor:"background.paper"},children:[n.jsx("canvas",{ref:m,style:{width:"100%",aspectRatio:"1",imageRendering:"pixelated",padding:"16px"}}),n.jsx(f,{sx:{display:"flex",flexDirection:"column",px:2},children:n.jsxs(Le,{children:[n.jsx(L,{children:"1. 斜率"}),n.jsx($,{value:a,min:0,max:4,step:1,onChange:(j,c)=>{r(c)},valueLabelDisplay:"auto",marks:!0}),n.jsxs(f,{sx:{display:"flex",flexDirection:"row",width:"100%",alignItems:"center",justifyContent:"space-between"},children:[n.jsx(L,{children:"2. 间距"}),n.jsx(D,{message:"间距越大，隐藏效果越好，但显形效果越差"})]}),n.jsx($,{value:d,min:1,max:4,step:1,onChange:(j,c)=>{l(c)},valueLabelDisplay:"auto",marks:!0}),n.jsx(L,{children:"3. 方向"}),n.jsxs(ds,{value:p?"row":"column",row:!0,onChange:(j,c)=>{o(c==="row")},children:[n.jsx(ne,{value:"row",control:n.jsx(oe,{}),label:"这样"}),n.jsx(ne,{value:"column",control:n.jsx(oe,{}),label:"或者这样"})]})]})}),n.jsxs(f,{sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",gap:1},children:[n.jsx(F,{variant:"text",onClick:e,children:"取消"}),n.jsx(f,{sx:{flex:1}}),n.jsx(F,{variant:"text",onClick:()=>{s(a,d,p)},color:"success",children:"确认"})]})]})}function js(){const s=u(t=>t.maxSize),e=u(t=>t.setMaxSize);return n.jsxs(f,{sx:{display:"flex",flexDirection:"row",alignItems:"end",justifyContent:"center",width:"100%",gap:1},children:[n.jsx(k,{children:"最大长或宽:"}),n.jsx(Ne,{initValue:s,onChange:t=>{e(t)},size:"small",variant:"standard",sx:{maxWidth:"100px"},min:v.minMaxSize,max:v.maxMaxSize}),n.jsx(D,{message:"此选项用于限制生成图像文件的大小"})]})}function Is(){const s=u(t=>t.isReverse),e=u(t=>t.setIsReverse);return n.jsxs(f,{sx:{display:"flex",flexDirection:"row",alignItems:"end",justifyContent:"center",width:"100%",gap:1},children:[n.jsx(k,{variant:"body1",children:"是否反向:"}),n.jsx(Ce,{size:"small",checked:s,onChange:t=>{e(t.target.checked)}}),n.jsx(D,{message:"“反向”即表图更暗 & 里图更亮的模式"})]})}function ys(){const s=u(c=>c.saveFormat),e=u(c=>c.setSaveFormat),t=te(c=>c.showWarning),a=te(c=>c.setShowWarning),[r,d]=h.useState(!1),l=Fe(c=>c.setImages),p=Ge(c=>c.setCurrentRoute),[o,m]=h.useState(!1),I=h.useCallback((c,y)=>{if(!y&&c!=="JPEG"&&t){d(!0);return}m(!0),R.saveResult(c).then(b=>{Me(`已保存为 ${b}`)}).catch(b=>{console.error("Failed to save result:",b),Y("保存失败")}).finally(()=>{m(!1)})},[t]),j=h.useCallback(c=>{m(!0),(async()=>{const y=await R.encodeResultToFile(c),b=await Ue.fromFileData(y);l([b]),p(Pe.decode)})().catch(y=>{console.error("Failed to encode result:",y),Y("跳转失败")}).finally(()=>{m(!1)})},[l,p]);return n.jsxs(f,{sx:{width:"100%",display:"flex",flexDirection:"row",gap:1},children:[n.jsx(_e,{show:r,onClose:()=>{d(!1)},onConfirm:()=>{d(!1),I(s,!0)},showWarning:t,setShowWarning:a,title:`确认保存为 ${s}?`,content:["非 JPEG 格式可能会被某些社交平台强制压缩，这将严重影响显形效果。请谨慎选择。"]}),n.jsx(F,{sx:{flex:1},variant:"contained",onClick:()=>{I(s,!1)},disabled:o,children:"保存结果"}),n.jsx(F,{sx:{flex:1},variant:"contained",color:"secondary",onClick:()=>{j(s)},disabled:o,children:"显形测试"}),n.jsx(Oe,{format:s,onChange:c=>{e(c)},disabled:o}),n.jsx(D,{message:"非 JPEG 格式有较高的被社交平台强制压缩的风险"})]})}export{Ds as default};
