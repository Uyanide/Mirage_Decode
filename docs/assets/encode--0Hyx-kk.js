import{i as G,k as E,r as c,l as U,j as o,m as S,n as z,o as N,p as H,T as M,q as oe,t as ge,v as A,w as ve,x as ie,y as Pe,z as ze,I as Fe,e as Te,A as ne,C as be,D as I,h as Ce,B as f,b as T,E as je,c as Ge,F as Ee,a as Ne,g as le,f as ce}from"./index-Bl150xPo.js";import{d as $e,u as re,f as ye,e as Be,g as We,p as Ue,h as Le,i as Ae,n as O,a as Ie,j as Re,T as qe,H as W,P as _e,c as Oe,I as Ve,S as X,b as de,F as He,k as ee}from"./help-button-DcEIAC8i.js";import{P as we,s as Je,I as J,C as Se,M as ue}from"./file-saver-B6zHcRF_.js";import{S as Xe,G as te,a as ae}from"./Switch-Dr0aDqTo.js";function Ye(e){return G("MuiDialogActions",e)}E("MuiDialogActions",["root","spacing"]);const Ze=e=>{const{classes:t,disableSpacing:s}=e;return N({root:["root",!s&&"spacing"]},Ye,t)},Ke=S("div",{name:"MuiDialogActions",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.root,!s.disableSpacing&&t.spacing]}})({display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end",flex:"0 0 auto",variants:[{props:({ownerState:e})=>!e.disableSpacing,style:{"& > :not(style) ~ :not(style)":{marginLeft:8}}}]}),Qe=c.forwardRef(function(t,s){const n=U({props:t,name:"MuiDialogActions"}),{className:a,disableSpacing:l=!1,...u}=n,r={...n,disableSpacing:l},d=Ze(r);return o.jsx(Ke,{className:z(d.root,a),ownerState:r,ref:s,...u})});function et(e){return G("MuiDialogContent",e)}E("MuiDialogContent",["root","dividers"]);function tt(e){return G("MuiDialogTitle",e)}const st=E("MuiDialogTitle",["root"]),ot=e=>{const{classes:t,dividers:s}=e;return N({root:["root",s&&"dividers"]},et,t)},nt=S("div",{name:"MuiDialogContent",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.root,s.dividers&&t.dividers]}})(H(({theme:e})=>({flex:"1 1 auto",WebkitOverflowScrolling:"touch",overflowY:"auto",padding:"20px 24px",variants:[{props:({ownerState:t})=>t.dividers,style:{padding:"16px 24px",borderTop:`1px solid ${(e.vars||e).palette.divider}`,borderBottom:`1px solid ${(e.vars||e).palette.divider}`}},{props:({ownerState:t})=>!t.dividers,style:{[`.${st.root} + &`]:{paddingTop:0}}}]}))),rt=c.forwardRef(function(t,s){const n=U({props:t,name:"MuiDialogContent"}),{className:a,dividers:l=!1,...u}=n,r={...n,dividers:l},d=ot(r);return o.jsx(nt,{className:z(d.root,a),ownerState:r,ref:s,...u})});function at(e){return G("MuiDialogContentText",e)}E("MuiDialogContentText",["root"]);const it=e=>{const{classes:t}=e,n=N({root:["root"]},at,t);return{...t,...n}},lt=S(M,{shouldForwardProp:e=>oe(e)||e==="classes",name:"MuiDialogContentText",slot:"Root"})({}),ct=c.forwardRef(function(t,s){const n=U({props:t,name:"MuiDialogContentText"}),{children:a,className:l,...u}=n,r=it(u);return o.jsx(lt,{component:"p",variant:"body1",color:"textSecondary",ref:s,ownerState:u,className:z(r.root,l),...n,classes:r})}),dt=e=>{const{classes:t}=e;return N({root:["root"]},tt,t)},ut=S(M,{name:"MuiDialogTitle",slot:"Root"})({padding:"16px 24px",flex:"0 0 auto"}),pt=c.forwardRef(function(t,s){const n=U({props:t,name:"MuiDialogTitle"}),{className:a,id:l,...u}=n,r=n,d=dt(r),{titleId:m=l}=c.useContext($e);return o.jsx(ut,{component:"h2",className:z(d.root,a),ownerState:r,ref:s,variant:"h6",id:l??m,...u})});function ht(e){return G("MuiFormControlLabel",e)}const V=E("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),xt=e=>{const{classes:t,disabled:s,labelPlacement:n,error:a,required:l}=e,u={root:["root",s&&"disabled",`labelPlacement${A(n)}`,a&&"error",l&&"required"],label:["label",s&&"disabled"],asterisk:["asterisk",a&&"error"]};return N(u,ht,t)},ft=S("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[{[`& .${V.label}`]:t.label},t.root,t[`labelPlacement${A(s.labelPlacement)}`]]}})(H(({theme:e})=>({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${V.disabled}`]:{cursor:"default"},[`& .${V.label}`]:{[`&.${V.disabled}`]:{color:(e.vars||e).palette.text.disabled}},variants:[{props:{labelPlacement:"start"},style:{flexDirection:"row-reverse",marginRight:-11}},{props:{labelPlacement:"top"},style:{flexDirection:"column-reverse"}},{props:{labelPlacement:"bottom"},style:{flexDirection:"column"}},{props:({labelPlacement:t})=>t==="start"||t==="top"||t==="bottom",style:{marginLeft:16}}]}))),mt=S("span",{name:"MuiFormControlLabel",slot:"Asterisk"})(H(({theme:e})=>({[`&.${V.error}`]:{color:(e.vars||e).palette.error.main}}))),se=c.forwardRef(function(t,s){const n=U({props:t,name:"MuiFormControlLabel"}),{checked:a,className:l,componentsProps:u={},control:r,disabled:d,disableTypography:m,inputRef:v,label:g,labelPlacement:p="end",name:C,onChange:i,required:x,slots:j={},slotProps:y={},value:b,...R}=n,D=re(),q=d??r.props.disabled??D?.disabled,k=x??r.props.required,L={disabled:q,required:k};["checked","name","onChange","value","inputRef"].forEach(B=>{typeof r.props[B]>"u"&&typeof n[B]<"u"&&(L[B]=n[B])});const Z=ye({props:n,muiFormControl:D,states:["error"]}),F={...n,disabled:q,labelPlacement:p,required:k,error:Z.error},$=xt(F),K={slots:j,slotProps:{...u,...y}},[Q,_]=ge("typography",{elementType:M,externalForwardedProps:K,ownerState:F});let P=g;return P!=null&&P.type!==M&&!m&&(P=o.jsx(Q,{component:"span",..._,className:z($.label,_?.className),children:P})),o.jsxs(ft,{className:z($.root,l),ownerState:F,ref:s,...R,children:[c.cloneElement(r,L),k?o.jsxs("div",{children:[P,o.jsxs(mt,{ownerState:F,"aria-hidden":!0,className:$.asterisk,children:[" ","*"]})]}):P]})});function gt(e){return G("MuiFormGroup",e)}E("MuiFormGroup",["root","row","error"]);const vt=e=>{const{classes:t,row:s,error:n}=e;return N({root:["root",s&&"row",n&&"error"]},gt,t)},bt=S("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.root,s.row&&t.row]}})({display:"flex",flexDirection:"column",flexWrap:"wrap",variants:[{props:{row:!0},style:{flexDirection:"row"}}]}),Ct=c.forwardRef(function(t,s){const n=U({props:t,name:"MuiFormGroup"}),{className:a,row:l=!1,...u}=n,r=re(),d=ye({props:n,muiFormControl:r,states:["error"]}),m={...n,row:l,error:d.error},v=vt(m);return o.jsx(bt,{className:z(v.root,a),ownerState:m,ref:s,...u})}),jt=ve(o.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"})),yt=ve(o.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"})),It=S("span",{name:"MuiRadioButtonIcon",shouldForwardProp:oe})({position:"relative",display:"flex"}),Rt=S(jt,{name:"MuiRadioButtonIcon"})({transform:"scale(1)"}),wt=S(yt,{name:"MuiRadioButtonIcon"})(H(({theme:e})=>({left:0,position:"absolute",transform:"scale(0)",transition:e.transitions.create("transform",{easing:e.transitions.easing.easeIn,duration:e.transitions.duration.shortest}),variants:[{props:{checked:!0},style:{transform:"scale(1)",transition:e.transitions.create("transform",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.shortest})}}]})));function De(e){const{checked:t=!1,classes:s={},fontSize:n}=e,a={...e,checked:t};return o.jsxs(It,{className:s.root,ownerState:a,children:[o.jsx(Rt,{fontSize:n,className:s.background,ownerState:a}),o.jsx(wt,{fontSize:n,className:s.dot,ownerState:a})]})}const Me=c.createContext(void 0);function St(){return c.useContext(Me)}function Dt(e){return G("MuiRadio",e)}const pe=E("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),Mt=e=>{const{classes:t,color:s,size:n}=e,a={root:["root",`color${A(s)}`,n!=="medium"&&`size${A(n)}`]};return{...t,...N(a,Dt,t)}},kt=S(Xe,{shouldForwardProp:e=>oe(e)||e==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.root,s.size!=="medium"&&t[`size${A(s.size)}`],t[`color${A(s.color)}`]]}})(H(({theme:e})=>({color:(e.vars||e).palette.text.secondary,[`&.${pe.disabled}`]:{color:(e.vars||e).palette.action.disabled},variants:[{props:{color:"default",disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.action.active,(e.vars||e).palette.action.hoverOpacity)}}},...Object.entries(e.palette).filter(ie()).map(([t])=>({props:{color:t,disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette[t].main,(e.vars||e).palette.action.hoverOpacity)}}})),...Object.entries(e.palette).filter(ie()).map(([t])=>({props:{color:t,disabled:!1},style:{[`&.${pe.checked}`]:{color:(e.vars||e).palette[t].main}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]})));function Pt(e,t){return typeof t=="object"&&t!==null?e===t:String(e)===String(t)}const zt=o.jsx(De,{checked:!0}),Ft=o.jsx(De,{}),he=c.forwardRef(function(t,s){const n=U({props:t,name:"MuiRadio"}),{checked:a,checkedIcon:l=zt,color:u="primary",icon:r=Ft,name:d,onChange:m,size:v="medium",className:g,disabled:p,disableRipple:C=!1,slots:i={},slotProps:x={},inputProps:j,...y}=n,b=re();let R=p;b&&typeof R>"u"&&(R=b.disabled),R??=!1;const D={...n,disabled:R,disableRipple:C,color:u,size:v},q=Mt(D),k=St();let L=a;const Z=Be(m,k&&k.onChange);let F=d;k&&(typeof L>"u"&&(L=Pt(k.value,n.value)),typeof F>"u"&&(F=k.name));const $=x.input??j,[K,Q]=ge("root",{ref:s,elementType:kt,className:z(q.root,g),shouldForwardComponentProp:!0,externalForwardedProps:{slots:i,slotProps:x,...y},getSlotProps:_=>({..._,onChange:(P,...B)=>{_.onChange?.(P,...B),Z(P,...B)}}),ownerState:D,additionalProps:{type:"radio",icon:c.cloneElement(r,{fontSize:r.props.fontSize??v}),checkedIcon:c.cloneElement(l,{fontSize:l.props.fontSize??v}),disabled:R,name:F,checked:L,slots:i,slotProps:{input:typeof $=="function"?$(D):$}}});return o.jsx(K,{...Q,classes:q})});function Tt(e){return G("MuiRadioGroup",e)}E("MuiRadioGroup",["root","row","error"]);const Gt=e=>{const{classes:t,row:s,error:n}=e;return N({root:["root",s&&"row",n&&"error"]},Tt,t)},Et=c.forwardRef(function(t,s){const{actions:n,children:a,className:l,defaultValue:u,name:r,onChange:d,value:m,...v}=t,g=c.useRef(null),p=Gt(t),[C,i]=We({controlled:m,default:u,name:"RadioGroup"});c.useImperativeHandle(n,()=>({focus:()=>{let b=g.current.querySelector("input:not(:disabled):checked");b||(b=g.current.querySelector("input:not(:disabled)")),b&&b.focus()}}),[]);const x=Pe(s,g),j=ze(r),y=c.useMemo(()=>({name:j,onChange(b){i(b.target.value),d&&d(b,b.target.value)},value:C}),[j,d,i,C]);return o.jsx(Me.Provider,{value:y,children:o.jsx(Ct,{role:"radiogroup",ref:x,className:z(p.root,l),...v,children:a})})});function ke(e,t,s,n,a){return s===0?(a?t:e)%(n+1)<n:a?(t/s+e)%(n+1)<n:(e/s+t)%(n+1)<n}function Nt(e,t,s,{innerThreshold:n,coverThreshold:a,slope:l,gap:u,isRow:r,isReverse:d}){const m=(i,x)=>ke(i,x,l,u,r),v=d?(i,x)=>255-x+i*x/255:(i,x)=>i*x/255,g=d?(i,x)=>i*(255-x)/255:(i,x)=>x+i*(255-x)/255,p=e.width,C=e.data.length;for(let i=0,x=0,j=0;i<C;i+=4){if(m(x,j)){const y=t.data[i],b=t.data[i+1],R=t.data[i+2],D=t.data[i+3];s.data[i]=g(y,a),s.data[i+1]=g(b,a),s.data[i+2]=g(R,a),s.data[i+3]=D}else{const y=e.data[i],b=e.data[i+1],R=e.data[i+2],D=e.data[i+3];s.data[i]=v(y,n),s.data[i+1]=v(b,n),s.data[i+2]=v(R,n),s.data[i+3]=D}x+=1,x>=p&&(x=0,j+=1)}}function $t(e,t,s){return`${s?"1":"0"}${e.toString(16).padStart(2,"0")}${t.toString(16).padStart(2,"0")}`}function Bt(e,t){const s=Ue(e),n=Wt[s];return n?n(e,t):(console.warn(`No metadata encoder found for MIME type: ${s}`),new Uint8Array(e))}const Wt={"image/jpeg":Ae,"image/png":Le};class xe extends we{resizedData=O();adjustedData=O();isInner;constructor(t){super(),this.isInner=t}bind(t){super.bind(t)}resizeFit(){if(!this.srcData.v)return;const{maxSize:t}=h.getState();J.resizeFit(t,this.srcData,this.resizedData)}resizeCover(t,s){this.srcData.v&&J.resizeCover(t,s,this.srcData,this.resizedData)}getSize(){return{width:this.resizedData.v?.width??0,height:this.resizedData.v?.height??0}}adjust(){if(!this.resizedData.v)return;let t,s;this.isInner?(t=h.getState().isInnerGray,s=h.getState().innerContrast):(t=h.getState().isCoverGray,s=h.getState().coverContrast);const n=O();t?J.toGray(this.resizedData,n):n.v=this.resizedData.v;const a=O();s!==50?J.adjustContrast(s,n,a):a.v=n.v,this.adjustedData.v=a.v}}class Ut extends we{inner=new xe(!0);cover=new xe(!1);resultData=O();bind(t){super.bind(t),this.subscribe(h.subscribe(s=>s.maxSize,()=>{this.resize(),this.encodeResult()})),this.subscribe(h.subscribe(s=>s.innerContrast,()=>{this.inner.adjust(),this.inner.putImageData(this.inner.adjustedData),this.encodeResult()})),this.subscribe(h.subscribe(s=>s.coverContrast,()=>{this.cover.adjust(),this.cover.putImageData(this.cover.adjustedData),this.encodeResult()})),this.subscribe(h.subscribe(s=>s.isInnerGray,()=>{this.inner.adjust(),this.inner.putImageData(this.inner.adjustedData),this.encodeResult()})),this.subscribe(h.subscribe(s=>s.isCoverGray,()=>{this.cover.adjust(),this.cover.putImageData(this.cover.adjustedData),this.encodeResult()})),this.subscribe(h.subscribe(s=>s.blendMode,()=>{this.encodeResult()})),this.subscribe(h.subscribe(s=>s.innerThreshold,()=>{this.encodeResult()})),this.subscribe(h.subscribe(s=>s.coverThreshold,()=>{this.encodeResult()})),this.subscribe(h.subscribe(s=>s.isReverse,()=>{this.encodeResult()})),this.resize(),this.encodeResult()}unbind(){super.unbind(),this.inner.unbind(),this.cover.unbind()}setInnerImage(t){this.inner.setImage(t,!1),this.resize(),this.cover.hasImage()&&this.encodeResult()}setCoverImage(t){this.cover.setImage(t,!1),this.inner.hasImage()&&(this.resize(),this.encodeResult())}resize(){if(!this.inner.hasImage()||(this.inner.resizeFit(),this.inner.adjust(),this.inner.putImageData(this.inner.adjustedData),!this.cover.hasImage()))return;const{width:t,height:s}=this.inner.getSize();this.cover.resizeCover(t,s),this.cover.adjust(),this.cover.putImageData(this.cover.adjustedData)}bindInner=t=>{this.inner.bind(t)};bindCover=t=>{this.cover.bind(t)};unbindInner=()=>{this.inner.unbind()};unbindCover=()=>{this.cover.unbind()};encodeResult(){const t=this.inner.adjustedData.v,s=this.cover.adjustedData.v;if(!t||!s||t.width!==s.width||t.height!==s.height)return;(!this.resultData.v||this.resultData.v.width!==t.width||this.resultData.v.height!==t.height)&&(this.resultData.v=new ImageData(t.width,t.height));const n=this.resultData.v,{innerThreshold:a,coverThreshold:l,blendMode:{slope:u,gap:r,isRow:d},isReverse:m}=h.getState();Nt(t,s,n,{innerThreshold:a,coverThreshold:l,slope:u,gap:r,isRow:d,isReverse:m}),this.resultData.v=n,Y.getState().haveResult=!0,this.putImageData(this.resultData)}async saveResult(t){const s=await this.encodeResultToFile(t);return Je(s,Fe[t])}async encodeResultToFile(t){if(!this.resultData.v)throw new Error("No result to encode");const s=this.resultData.v,{innerThreshold:n,innerContrast:a,isReverse:l}=h.getState(),u=$t(n,a,l),r=await Te(s,t);return Bt(r,u)}}const w=new Ut,h=ne()(be(e=>({innerThreshold:I.innerThreshold,coverThreshold:I.coverThreshold,innerContrast:I.innerContrast,coverContrast:I.coverContrast,isInnerGray:I.isInnerGray,isCoverGray:I.isCoverGray,isReverse:I.isReverse,saveFormat:I.saveFormat,maxSize:I.maxSize,blendMode:{slope:I.blendMode.slope,gap:I.blendMode.gap,isRow:I.blendMode.isRow},setInnerThreshold:t=>{e(s=>t>s.coverThreshold?{}:{innerThreshold:t})},setCoverThreshold:t=>{e(s=>t<s.innerThreshold?{}:{coverThreshold:t})},setInnerContrast:t=>{e({innerContrast:t})},setCoverContrast:t=>{e({coverContrast:t})},setIsInnerGray:t=>{e({isInnerGray:t})},setIsCoverGray:t=>{e({isCoverGray:t})},setIsReverse:t=>{e({isReverse:t})},setSaveFormat:t=>{e({saveFormat:t})},setMaxSize:t=>{e({maxSize:t})},setBlendMode:(t,s,n)=>{e({blendMode:{slope:t,gap:s,isRow:n}})}}))),Y=ne()(be(e=>({innerImage:null,coverImage:null,haveResult:!1,setInnerImage:t=>{t&&w.setInnerImage(t),e({innerImage:t})},setCoverImage:t=>{t&&w.setCoverImage(t),e({coverImage:t})},setHaveResult:t=>{e({haveResult:t})}}))),Lt=(e,t)=>{const[s,n]=c.useState(e);return c.useEffect(()=>{const a=setTimeout(()=>{n(e)},t);return()=>{clearTimeout(a)}},[e,t]),s},fe=ne(e=>({showWarning:!0,setShowWarning:t=>{e({showWarning:t})}}));function ss(){const e=Ce();return o.jsxs(f,{sx:{display:"flex",flexDirection:"column",width:"100%",maxWidth:e?"lg":"sm"},children:[o.jsx(At,{}),o.jsxs(f,{sx:{display:"flex",flexDirection:e?"row":"column",mt:2,gap:2},children:[o.jsx(Vt,{}),o.jsx(Ot,{})]})]})}function At(){const e=Ce();return o.jsxs(te,{container:!0,spacing:2,children:[o.jsx(te,{size:e?6:12,children:o.jsx(me,{isCover:!1})}),o.jsx(te,{size:e?6:12,children:o.jsx(me,{isCover:!0})})]})}function me({isCover:e}){return o.jsx(Ie,{children:o.jsxs(f,{sx:{display:"flex",flexDirection:"row",width:"100%",gap:2,alignItems:"center"},children:[o.jsx(qt,{isCover:e}),o.jsx(_t,{isCover:e})]})})}function qt({isCover:e}){const t=Y(e?a=>a.coverImage:a=>a.innerImage),s=Y(e?a=>a.setCoverImage:a=>a.setInnerImage),n=c.useRef(null);return c.useEffect(()=>{const a=n.current;if(a)return e?w.bindCover(a):w.bindInner(a),()=>{e?w.unbindCover():w.unbindInner()}}),o.jsxs(f,{sx:{display:"flex",flexDirection:"column",gap:1,px:1,width:"200px"},children:[o.jsx(Ve,{onconfirm:a=>{s(a)},defaultImage:e?ce.encodeCover:ce.encodeInner}),!t&&o.jsx(Se,{text:"(･_･`)>",aspectRatio:"1",styles:{maxWidth:"200px",maxHeight:"200px",objectFit:"contain"}}),o.jsx("canvas",{ref:n,style:{maxWidth:"200px",maxHeight:"200px",display:t?"block":"none",objectFit:"contain",imageRendering:"pixelated"}})]})}function _t({isCover:e}){const t=h(e?r=>r.coverThreshold:r=>r.innerThreshold),s=h(e?r=>r.coverContrast:r=>r.innerContrast),n=h(e?r=>r.isCoverGray:r=>r.isInnerGray),a=h(e?r=>r.setCoverThreshold:r=>r.setInnerThreshold),l=h(e?r=>r.setCoverContrast:r=>r.setInnerContrast),u=h(e?r=>r.setIsCoverGray:r=>r.setIsInnerGray);return o.jsxs(f,{sx:{flex:1,display:"flex",flexDirection:"column"},children:[o.jsx(M,{variant:"subtitle1",color:"primary",children:e?"表图设置":"里图设置"}),o.jsxs(f,{sx:{mt:1,display:"flex",flexDirection:"row",alignItems:"center"},children:[o.jsx(M,{variant:"body2",children:"1. 色阶端点:"}),o.jsx(f,{sx:{flex:1}}),o.jsx(W,{message:e?"越高显形效果越好":"越低隐藏效果越好"})]}),o.jsx(X,{value:t,min:0,max:255,step:1,track:e?"inverted":"normal",onChange:(r,d)=>{a(d)},valueLabelDisplay:"auto"}),o.jsx(f,{sx:{display:"flex",flexDirection:"row",gap:1},children:o.jsx(de,{value:t,inputProps:{step:1,min:0,max:255,type:"number"},sx:{width:"80px"},onChange:r=>{const d=parseInt(r.target.value,10);isNaN(d)||a(d)}})}),o.jsxs(f,{sx:{mt:1,display:"flex",flexDirection:"row",alignItems:"center"},children:[o.jsx(M,{variant:"body2",children:"2. 对比度:"}),o.jsx(f,{sx:{flex:1}}),o.jsx(W,{message:"不合理的对比度会严重降低显形质量"})]}),o.jsx(X,{value:s,min:0,max:100,step:1,onChange:(r,d)=>{l(d)},valueLabelDisplay:"auto"}),o.jsxs(f,{sx:{display:"flex",flexDirection:"row",gap:1},children:[o.jsx(de,{value:s,inputProps:{step:1,min:0,max:255,type:"number"},sx:{width:"80px"},onChange:r=>{const d=parseInt(r.target.value,10);isNaN(d)||l(d)}}),o.jsx(T,{size:"small",sx:{width:"80px"},onClick:()=>{l(50)},children:"重置对比度"})]}),o.jsxs(f,{sx:{mt:1,display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[o.jsx(M,{variant:"body2",children:"3. 取灰度:"}),o.jsx(ae,{size:"medium",checked:n,onChange:r=>{u(r.target.checked)}}),o.jsx(f,{sx:{flex:1}}),o.jsx(W,{message:"舍弃颜色可显著提升抗压缩能力"})]}),o.jsx(f,{sx:{mt:1,display:"flex",flexDirection:"row",alignItems:"center",gap:1}})]})}function Ot(){return o.jsxs(f,{sx:{display:"flex",flexDirection:"column",width:"100%",gap:2},children:[o.jsx(Ie,{children:o.jsxs(f,{sx:{display:"flex",flexDirection:"column",gap:2,width:"100%"},children:[o.jsx(Ht,{}),o.jsx(Xt,{}),o.jsx(Yt,{})]})}),o.jsx(Zt,{})]})}function Vt(){const e=c.useRef(null),t=Y(s=>s.haveResult);return c.useEffect(()=>{const s=e.current;if(s)return w.bind(s),()=>{w.unbind()}},[]),o.jsxs(o.Fragment,{children:[!t&&o.jsx(Se,{text:"只是一张画布",styles:{width:"100%"}}),o.jsx("canvas",{ref:e,style:{width:"100%",display:t?"block":"none"}})]})}function Ht(){const[e,t]=c.useState(!1),s=h(l=>l.setBlendMode),n=c.useCallback((l,u,r)=>{s(l,u,r),t(!1),w.encodeResult()},[s]),a=c.useCallback(()=>{t(!1)},[]);return o.jsxs(o.Fragment,{children:[o.jsx(T,{variant:"contained",onClick:()=>{t(!0)},children:"设置混合模式"}),o.jsx(Re,{open:e,maxWidth:"sm",fullWidth:!0,sx:{zIndex:je.dialog},children:o.jsx(Jt,{onConfirm:n,onCancel:a})})]})}function Jt({onConfirm:e,onCancel:t}){const s=h(g=>g.blendMode),[n,a]=c.useState(s.slope),[l,u]=c.useState(s.gap),[r,d]=c.useState(s.isRow),m=c.useRef(null),v=c.useCallback((g,p,C)=>{const i=m.current;if(!i)return;i.width=8,i.height=8;const x=i.getContext("2d");if(x){x.imageSmoothingEnabled=!1;for(let j=0;j<i.width;j++)for(let y=0;y<i.height;y++)ke(j,y,g,p,C)?x.fillStyle="white":x.fillStyle="black",x.fillRect(j,y,1,1)}},[]);return c.useEffect(()=>{v(n,l,r)},[n,l,r,v]),o.jsxs(f,{sx:{display:"flex",flexDirection:"column",padding:2,backgroundColor:"background.paper"},children:[o.jsx("canvas",{ref:m,style:{width:"100%",aspectRatio:"1",imageRendering:"pixelated",padding:"16px"}}),o.jsx(f,{sx:{display:"flex",flexDirection:"column",px:2},children:o.jsxs(He,{children:[o.jsx(ee,{children:"1. 斜率"}),o.jsx(X,{value:n,min:0,max:4,step:1,onChange:(g,p)=>{a(p)},valueLabelDisplay:"auto",marks:!0}),o.jsxs(f,{sx:{display:"flex",flexDirection:"row",width:"100%",alignItems:"center",justifyContent:"space-between"},children:[o.jsx(ee,{children:"2. 间距"}),o.jsx(W,{message:"间距越大，隐藏效果越好，但显形效果越差"})]}),o.jsx(X,{value:l,min:1,max:4,step:1,onChange:(g,p)=>{u(p)},valueLabelDisplay:"auto",marks:!0}),o.jsx(ee,{children:"3. 方向"}),o.jsxs(Et,{value:r?"row":"column",row:!0,onChange:(g,p)=>{d(p==="row")},children:[o.jsx(se,{value:"row",control:o.jsx(he,{}),label:"这样"}),o.jsx(se,{value:"column",control:o.jsx(he,{}),label:"或者这样"})]})]})}),o.jsxs(f,{sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",gap:1},children:[o.jsx(T,{variant:"text",onClick:t,children:"取消"}),o.jsx(f,{sx:{flex:1}}),o.jsx(T,{variant:"text",onClick:()=>{e(n,l,r)},color:"success",children:"确认"})]})]})}function Xt(){const e=h(r=>r.maxSize),t=h(r=>r.setMaxSize),[s,n]=c.useState(e.toString()),[a,l]=c.useState(!0),u=Lt(s,500);return c.useEffect(()=>{const r=parseInt(u,10);if(isNaN(r)||r<I.minWidth||r>I.maxSize){l(!1);return}l(!0),t(r)},[u,t]),o.jsxs(f,{sx:{display:"flex",flexDirection:"row",alignItems:"end",justifyContent:"center",width:"100%",gap:1},children:[o.jsx(M,{children:"最大长或宽:"}),o.jsx(qe,{value:s,onChange:r=>{n(r.target.value)},size:"small",variant:"standard",error:!a,sx:{maxWidth:"100px"}}),o.jsx(W,{message:"此选项用于限制生成图像文件的大小"})]})}function Yt(){const e=h(s=>s.isReverse),t=h(s=>s.setIsReverse);return o.jsxs(f,{sx:{display:"flex",flexDirection:"row",alignItems:"end",justifyContent:"center",width:"100%",gap:1},children:[o.jsx(M,{variant:"body1",children:"是否反向:"}),o.jsx(ae,{size:"small",checked:e,onChange:s=>{t(s.target.checked)}}),o.jsx(W,{message:"“反向”即表图更暗 & 里图更亮的模式"})]})}function Zt(){const e=h(p=>p.saveFormat),t=h(p=>p.setSaveFormat),s=fe(p=>p.showWarning),n=fe(p=>p.setShowWarning),[a,l]=c.useState(!1),u=Ge(p=>p.setImages),r=Ee(p=>p.setCurrentRoute),[d,m]=c.useState(!1),v=c.useCallback((p,C)=>{if(!C&&p!=="JPEG"&&s){l(!0);return}m(!0),w.saveResult(p).then(i=>{Ne(`已保存为 ${i}`)}).catch(i=>{console.error("Failed to save result:",i),le("保存失败")}).finally(()=>{m(!1)})},[s]),g=c.useCallback(p=>{m(!0),(async()=>{const C=await w.encodeResultToFile(p),i=await _e.fromFileData(C);u([i]),r("/decode")})().catch(C=>{console.error("Failed to encode result:",C),le("跳转失败")}).finally(()=>{m(!1)})},[u,r]);return o.jsxs(f,{sx:{width:"100%",display:"flex",flexDirection:"row",gap:1},children:[o.jsxs(Re,{open:a,onClose:()=>{l(!1)},maxWidth:"sm",fullWidth:!0,sx:{zIndex:je.dialog},children:[o.jsx(pt,{id:"alert-dialog-title",children:`确认保存为 ${e}？`}),o.jsxs(rt,{children:[o.jsx(ct,{id:"alert-dialog-description",children:"非 JPEG 格式可能会被社交平台强制压缩，这将严重影响显形效果。请谨慎选择。"}),o.jsx(se,{control:o.jsx(ae,{checked:!s,onChange:p=>{n(!p.target.checked)}}),label:"本次不再显示此提示"})]}),o.jsxs(Qe,{children:[o.jsx(T,{onClick:()=>{l(!1)},children:"取消"}),o.jsx(T,{onClick:()=>{l(!1),v(e,!0)},autoFocus:!0,children:"仍然保存"})]})]}),o.jsx(T,{sx:{flex:1},variant:"contained",onClick:()=>{v(e,!1)},disabled:d,children:"保存结果"}),o.jsx(T,{sx:{flex:1},variant:"contained",color:"secondary",onClick:()=>{g(e)},disabled:d,children:"显形测试"}),o.jsxs(Oe,{value:e,variant:"standard",sx:{minWidth:80},onChange:p=>{t(p.target.value)},disabled:d,children:[o.jsx(ue,{value:"JPEG",children:"JPEG"}),o.jsx(ue,{value:"PNG",children:"PNG"})]}),o.jsx(W,{message:"非 JPEG 格式有较高地被社交平台强制压缩的风险"})]})}export{ss as default};
